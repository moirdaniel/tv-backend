name: Deploy TV Backend

on:
  push:
    branches:
      - Serv01

jobs:
  deploy:
    name: Desplegar en Serv01
    runs-on: self-hosted

    steps:
    - name: Clonar c√≥digo desde GitHub privado
      run: |
        sudo rm -rf /tmp/tv-backend
        git clone https://x-access-token:${{ secrets.GH_PAT }}@github.com/moirdaniel/tv-backend.git /tmp/tv-backend

    - name: Copiar archivos al directorio de despliegue
      run: |
        sudo rm -rf /docker-apps/tv-backend/*
        sudo cp -r /tmp/tv-backend/* /docker-apps/tv-backend/

    - name: Desplegar con Docker Compose
      run: |
        cd /docker-apps/tv-backend
        docker-compose pull
        docker-compose up -d --remove-orphans

    - name: Verificar estado de contenedores
      run: docker ps
